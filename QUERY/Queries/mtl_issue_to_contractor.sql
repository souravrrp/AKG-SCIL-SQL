select
    ood.organization_code,
    mmt.transaction_id,
    trunc(mmt.transaction_date) txn_date,
    mmt.transaction_source_id,
    mtst.transaction_source_type_name,
    mtt.transaction_type_name,
    pja.name,
    pt.task_name,
    mtrh.attribute_category,
    decode(mtrh.attribute_category,
    'Use of Area',mtrh.attribute4,
    (select vendor_name
    from apps.ap_suppliers
    where to_char(vendor_id)=mtrh.attribute1)) contractor_name,
    msi.segment1||'.'||msi.segment2||'.'||msi.segment3 item_code,
    msi.description,
    nvl(mmt.transaction_quantity,mmt.primary_quantity) txn_qty,
    nvl(mmt.transaction_cost,mmt.actual_cost) txn_unit_cost,
    nvl(mmt.transaction_quantity,mmt.primary_quantity)*nvl(mmt.transaction_cost,mmt.actual_cost) txn_value
--    mtrh.*
from
    inv.mtl_system_items_b msi,
    inv.mtl_material_transactions mmt,
    inv.mtl_txn_request_headers mtrh,
    inv.mtl_txn_request_lines mtrl,
    inv.mtl_txn_source_types mtst,
    inv.mtl_transaction_types mtt,
    apps.org_organization_definitions ood,
    pa.pa_projects_all pja,
    pa.pa_tasks pt
where
    msi.inventory_item_id=mmt.inventory_item_id
    and msi.organization_id=mmt.organization_id
    and mmt.transaction_source_type_id=mtst.transaction_source_type_id
    and mmt.transaction_type_id=mtt.transaction_type_id    
    and mmt.organization_id=ood.organization_id
    and ood.organization_code='AKM'
    and mmt.transaction_source_type_id=4
    and to_char(mmt.transaction_source_id)=mtrh.request_number
    and mmt.organization_id=mtrh.organization_id
    and mmt.organization_id=mtrh.organization_id
    and mmt.TRX_SOURCE_LINE_ID=mtrl.line_id
    and mtrl.project_id=pja.project_id(+)
    and mtrl.task_id=pt.task_id(+)
--    and mmt.transaction_id=2461311
--    and mtrh.header_id=mtrl.header_id
    and mtt.transaction_type_name = 'Material Issue to Contractor'
--    and mtrh.request_number in ('361360',
--'369308',
--'389652',
--'389775',
--'393098',
--'393146',
--'393154',
--'393446',
--'394343',
--'394379',
--'396818',
--'399020',
--'399046',
--'399114',
--'399144',
--'407257',
--'415760',
--'417341',
--'417457',
--'417966',
--'418032',
--'421858',
--'421876',
--'422115',
--'422310',
--'423754',
--'426822',
--'426910',
--'427133',
--'427204',
--'427406',
--'428417',
--'428475',
--'428515',
--'428831',
--'428862',
--'428872',
--'428897',
--'428944',
--'429006',
--'429030',
--'429035',
--'429039',
--'429040',
--'429056',
--'429060',
--'429068',
--'429090',
--'429096',
--'429123',
--'430057',
--'430075',
--'430542',
--'430557',
--'431385',
--'431391',
--'431490',
--'431924',
--'431934',
--'431970',
--'431978',
--'431989',
--'432024',
--'432046',
--'432052',
--'432059',
--'432065',
--'433244',
--'433824',
--'433957',
--'433974',
--'434540',
--'434571',
--'435041',
--'436735',
--'440259',
--'441510',
--'441527',
--'441555',
--'441609',
--'441758',
--'441768',
--'441780',
--'441814',
--'441823',
--'441832',
--'441843',
--'441891',
--'441909',
--'441924',
--'441962',
--'441968',
--'441974',
--'441981',
--'443139',
--'443826',
--'445100',
--'447669',
--'448850',
--'451519',
--'452669',
--'452767',
--'452788',
--'452895',
--'453042',
--'453848',
--'455145',
--'457272',
--'457450',
--'457457',
--'458418',
--'460132',
--'461821',
--'466955',
--'466960',
--'467182',
--'468729',
--'473019',
--'473060',
--'495523',
--'502885',
--'675272',
--'1004194',
--'1190843',
--'1238332',
--'1258971',
--'1278607',
--'1278633',
--'1293410',
--'1293567',
--'1294404',
--'1303514',
--'1312470',
--'1344536',
--'1373527',
--'1397883',
--'1399821',
--'1406567',
--'1406570',
--'1406578',
--'1406583',
--'1406592',
--'1428286',
--'1451115',
--'1459289',
--'1459323',
--'1507092',
--'1511527',
--'1581979',
--'1944587',
--'2194214',
--'2410088',
--'2441837',
--'2451429',
--'2665467',
--'2731013',
--'2762037',
--'2857634',
--'2858620',
--'2858724',
--'3213608',
--'3221627',
--'3223699',
--'3224125',
--'3231553',
--'3231584',
--'3231644',
--'3236827',
--'3236896',
--'3239582',
--'3256747',
--'3256939',
--'3287495',
--'3309099',
--'3336856',
--'3355468',
--'3355752',
--'3361180',
--'3361211',
--'3367652',
--'3382366',
--'3386248',
--'3398900',
--'3400622',
--'3404035',
--'3409943',
--'3413605',
--'3441090',
--'3443285',
--'3447760',
--'3455250',
--'3455267',
--'3459288',
--'3473407',
--'3488166',
--'3488177',
--'3504934',
--'3508830',
--'3520976',
--'3543568',
--'3548945',
--'3553228',
--'3553349',
--'3558960',
--'3582920',
--'3624892',
--'3655435',
--'3655711',
--'3655947',
--'3659405',
--'3679997',
--'3747944',
--'3749814',
--'3754453',
--'3754699',
--'3755125',
--'3755195',
--'3755341',
--'3764498',
--'3764510',
--'3809670',
--'3809687',
--'3812870',
--'3825360',
--'3829431',
--'3829696',
--'3829713',
--'3831006',
--'3831053',
--'3834734',
--'3834819',
--'3836806',
--'3836958',
--'3851924',
--'3864626',
--'3867598',
--'3868451',
--'3870348',
--'3870703',
--'3875547',
--'3879528',
--'3880160',
--'3880202',
--'3883997',
--'3887945',
--'3887981',
--'3888310',
--'3888770',
--'3888782',
--'3888801',
--'4083658',
--'4101351',
--'4187322',
--'4191178',
--'4191213',
--'4222754',
--'4233298',
--'4248018',
--'4358416')
--    and pja.name is not null
DROP VIEW APPS.XXAKG_OE_DO2MOVE_NEW_V;

/* Formatted on 10/9/2019 10:14:03 AM (QP5 v5.287) */
CREATE OR REPLACE FORCE VIEW APPS.XXAKG_OE_DO2MOVE_NEW_V
(
   DO_HDR_ID,
   ORG_ID,
   OPERATING_UNIT,
   DO_NUMBER,
   DO_STATUS,
   DO_DATE,
   DO_DATE_TIME,
   CUSTOMER_NUMBER,
   CUSTOMER_NAME,
   DO_MODE_OF_TRANSPORT,
   DO_TRANSPORTER_VENDOR_ID,
   DO_TRANSPORTER_NAME,
   READY_FOR_PRINTING,
   PRINTING_DATE,
   ORDER_NUMBER,
   ORDER_HEADER_ID,
   ORDER_LINE_ID,
   LINE_NUMBER,
   ORDERED_ITEM_ID,
   ITEM_NUMBER,
   ITEM_DESCRIPTION,
   LINE_QUANTITY,
   CONVERT_BAG_QTY,
   SHIPPED_QTY,
   CONVERT_SHIPPED_BAG_QTY,
   ACTUAL_SHIPPED_DATE,
   UNIT_SELLING_PRICE,
   UOM_CODE,
   DO_WAREHOUSE_ORG_ID,
   DO_WAREHOUSE_ORG_CODE,
   DO_WAREHOUSE_ORG_NAME,
   SHIP_TO_ORG_ID,
   SHIP_TO_LOCATION,
   ACTUAL_RETAILER_SHIP_TO,
   ITEM_PRICE_LOCATION,
   TERRITORY,
   PARENT_LINE_NUMBER,
   ORIGINAL_ITEM_NUMBER,
   PRICE_LIST_ID,
   PRICING_DATE,
   ACTUAL_DELIVERY_QTY,
   HAND_OVER_DATE,
   DELIVERY_MODE,
   RETAILER_PHONE_NO,
   MOV_ORD_HDR_ID,
   MOV_ORDER_NO,
   MOV_ORDER_DATE,
   MOV_ORDER_STATUS,
   GATE_PASS_NO,
   GATE_PASS_DATE,
   FINAL_DESTINATION,
   MOVE_WAREHOUSE_ORG_ID,
   MOVE_WAREHOUSE_ORG_CODE,
   MOVE_WAREHOUSE_ORG_NAME,
   MOVE_MODE_OF_TRANSPORT,
   VEHICLE_NO,
   GATE_OUT,
   GATE_OUT_DATE,
   GATE_IN,
   GATE_IN_DATE,
   VEHICLE_TYPE,
   MOVE_TRANSPORTER_VENDOR_ID,
   MOVE_TRANSPORTER_NAME,
   INITIAL_GATE_IN,
   INITIAL_GATE_IN_DATE,
   EMPTY_TRUCK_WT,
   EMPTY_TRUCK_WT_DATE,
   DRIVER_NAME,
   FULL_TRUCK_WT,
   FULL_TRUCK_WT_DATE,
   SCALE_OUT_WT,
   HIRE_RATE_AP,
   HIRE_RATE_AR,
   CONFIRM_FLAG,
   CONFIRM_DATE,
   TRANSFER_LOADING_FLAG,
   TRANSFER_LOADING_DATE,
   TRUCK_LOADING_FLAG,
   TRUCK_LOADING_DATE,
   VAT_RECEIVED_FLAG,
   VAT_RECEIVED_DATE,
   CHALLANED_FLAG,
   CHALLANED_DATE,
   VAT_CHALLAN_NO,
   VAT_CHALLAN_DATE,
   VAT_IN_FLAG,
   VAT_IN_DATE,
   MOV_ORDER_TYPE,
   METER_READING_START,
   METER_READING_END,
   OIL_REFILL_QTY_CNG,
   OIL_REFILL_QTY_OCTANE,
   KM_PER_LITRE,
   MOV_AR_FLAG,
   DRIVER_MOBILE,
   CONFIRMED_DATE
)
   BEQUEATH DEFINER
AS
   SELECT D.DO_HDR_ID,
          D.ORG_ID,
          xxakg_com_pkg.get_organization_name (D.ORG_ID) OPERATING_UNIT,
          D.DO_NUMBER,
          DO_STATUS,
          D.DO_DATE,
          D.DO_DATE_TIME,
          D.CUSTOMER_NUMBER,
          D.CUSTOMER_NAME,
          D.MODE_OF_TRANSPORT DO_MODE_OF_TRANSPORT,
          D.TRANSPORTER_VENDOR_ID DO_TRANSPORTER_VENDOR_ID,
          D.TRANSPORTER_NAME DO_TRANSPORTER_NAME,
          D.READY_FOR_PRINTING,
          D.PRINTING_DATE,
          D.ORDER_NUMBER,
          D.ORDER_HEADER_ID,
          D.ORDER_LINE_ID,
          D.LINE_NUMBER,
          D.ORDERED_ITEM_ID,
          D.ITEM_NUMBER,
          D.ITEM_DESCRIPTION,
          D.LINE_QUANTITY,
          D.CONVERT_BAG_QTY,
          D.SHIPPED_QTY,
          DECODE (UOM_CODE,
                  'MTN', NVL (D.SHIPPED_QTY, 0) * 20,
                  NVL (D.SHIPPED_QTY, 0))
             CONVERT_SHIPPED_BAG_QTY,
          XXAKG_BI_ONT_PKG.GET_ACTUAL_SHIPPED_DATE (D.ORG_ID,
                                                    D.ORDER_LINE_ID)
             ACTUAL_SHIPPED_DATE,
          D.UNIT_SELLING_PRICE,
          D.UOM_CODE,
          D.WAREHOUSE_ORG_ID DO_WAREHOUSE_ORG_ID,
          D.WAREHOUSE_ORG_CODE DO_WAREHOUSE_ORG_CODE,
          xxakg_com_pkg.get_organization_name (D.WAREHOUSE_ORG_ID)
             DO_WAREHOUSE_ORG_NAME,
          D.SHIP_TO_ORG_ID,
          D.SHIP_TO_LOCATION,
          D.ACTUAL_RETAILER_SHIP_TO,
          D.ITEM_PRICE_LOCATION,
          D.TERRITORY,
          D.PARENT_LINE_NUMBER,
          D.ORIGINAL_ITEM_NUMBER,
          D.PRICE_LIST_ID,
          D.PRICING_DATE,
          D.ACTUAL_DELIVERY_QTY,
          D.HAND_OVER_DATE,
          D.DELIVERY_MODE,
          D.RETAILER_PHONE_NO,
          M.MOV_ORD_HDR_ID,
          M.MOV_ORDER_NO,
          M.MOV_ORDER_DATE,
          M.MOV_ORDER_STATUS,
          M.GATE_PASS_NO,
          M.GATE_PASS_DATE,
          M.FINAL_DESTINATION,
          M.WAREHOUSE_ORG_ID MOVE_WAREHOUSE_ORG_ID,
          M.WAREHOUSE_ORG_CODE MOVE_WAREHOUSE_ORG_CODE,
          xxakg_com_pkg.get_organization_name (M.WAREHOUSE_ORG_ID)
             MOVE_WAREHOUSE_ORG_NAME,
          M.TRANSPORT_MODE MOVE_MODE_OF_TRANSPORT,
          M.VEHICLE_NO,
          M.GATE_OUT,
          M.GATE_OUT_DATE,
          M.GATE_IN,
          M.GATE_IN_DATE,
          M.VEHICLE_TYPE,
          M.TRANSPORTER_VENDOR_ID MOVE_TRANSPORTER_VENDOR_ID,
          M.TRANSPORTER_NAME MOVE_TRANSPORTER_NAME,
          M.INITIAL_GATE_IN,
          M.INITIAL_GATE_IN_DATE,
          M.EMPTY_TRUCK_WT,
          M.EMPTY_TRUCK_WT_DATE,
          M.DRIVER_NAME,
          M.SCALE_IN_WT,
          M.FULL_TRUCK_WT_DATE,
          M.SCALE_OUT_WT,
          M.HIRE_RATE_AP,
          M.HIRE_RATE_AR,
          M.CONFIRM_FLAG,
          M.CONFIRM_DATE,
          M.TRANSFER_LOADING_FLAG,
          M.TRANSFER_LOADING_DATE,
          M.TRUCK_LOADING_FLAG,
          M.TRUCK_LOADING_DATE,
          M.VAT_RECEIVED_FLAG,
          M.VAT_RECEIVED_DATE,
          M.CHALLANED_FLAG,
          M.CHALLANED_DATE,
          M.VAT_CHALLAN_NO,
          M.VAT_CHALLAN_DATE,
          M.VAT_IN_FLAG,
          M.VAT_IN_DATE,
          M.MOV_ORDER_TYPE,
          M.METER_READING_START,
          M.METER_READING_END,
          M.OIL_REFILL_QTY_CNG,
          M.OIL_REFILL_QTY_OCTANE,
          M.KM_PER_LITRE,
          M.AR_FLAG,
          M.DRIVER_MOBILE,
          M.CONFIRMED_DATE
     FROM (SELECT DH.DO_HDR_ID,
                  DH.ORG_ID,
                  DH.DO_NUMBER,
                  DO_STATUS,
                  TRUNC (DH.DO_DATE) DO_DATE,
                  DH.DO_DATE DO_DATE_TIME,
                  CUSTOMER_NUMBER,
                  CUSTOMER_NAME,
                  DH.MODE_OF_TRANSPORT,
                  DH.TRANSPORTER_VENDOR_ID,
                  DH.TRANSPORTER_NAME,
                  DH.READY_FOR_PRINTING,
                  DH.PRINTING_DATE,
                  ORDER_NUMBER,
                  ORDER_HEADER_ID,
                  ORDER_LINE_ID,
                  LINE_NUMBER,
                  ORDERED_ITEM_ID,
                  ITEM_NUMBER,
                  ITEM_DESCRIPTION,
                  NVL (LINE_QUANTITY, 0) LINE_QUANTITY,
                  XXAKG_BI_ONT_PKG.GET_SHIPPED_QTY (DL.ORG_ID,
                                                    DL.ORDER_LINE_ID)
                     SHIPPED_QTY,
                  DECODE (UOM_CODE,
                          'MTN', NVL (LINE_QUANTITY, 0) * 20,
                          NVL (LINE_QUANTITY, 0))
                     CONVERT_BAG_QTY,
                  GET_UNIT_SELLING_PRICE (DH.ORG_ID,
                                          DH.DO_STATUS,
                                          ORDER_HEADER_ID,
                                          ORDER_LINE_ID,
                                          ORDERED_ITEM_ID)
                     UNIT_SELLING_PRICE,
                  UOM_CODE,
                  DL.WAREHOUSE_ORG_ID,
                  WAREHOUSE_ORG_CODE,
                  SHIP_TO_ORG_ID,
                  SHIP_TO_LOCATION,
                  ACTUAL_RETAILER_SHIP_TO,
                  ITEM_PRICE_LOCATION,
                  DL.TERRITORY,
                  DL.PARENT_LINE_NUMBER,
                  DL.ORIGINAL_ITEM_NUMBER,
                  DL.PRICE_LIST_ID,
                  DL.PRICING_DATE,
                  DL.ACTUAL_DELIVERY_QTY,
                  DH.HAND_OVER_DATE,
                  DH.DELIVERY_MODE,
                  XXAKG_ONT_PKG.GET_RETAILER_PHONE_NO (DL.SHIP_TO_ORG_ID)
                     RETAILER_PHONE_NO
             FROM XXAKG_DEL_ORD_HDR DH, XXAKG_DEL_ORD_DO_LINES DL
            WHERE DH.DO_HDR_ID = DL.DO_HDR_ID AND DH.ORG_ID = 85
            AND DL.WAREHOUSE_ORG_ID='101') D,
          (SELECT MH.MOV_ORD_HDR_ID,
                  DO_HDR_ID,
                  MOV_ORDER_NO,
                  TRUNC (MOV_ORDER_DATE) MOV_ORDER_DATE,
                  MOV_ORDER_STATUS,
                  GATE_PASS_NO,
                  GATE_PASS_DATE,
                  FINAL_DESTINATION,
                  WAREHOUSE_ORG_CODE,
                  WAREHOUSE_ORG_ID,
                  TRANSPORT_MODE,
                  VEHICLE_NO,
                  GATE_OUT,
                  GATE_OUT_DATE,
                  GATE_IN,
                  GATE_IN_DATE,
                  VEHICLE_TYPE,
                  TRANSPORTER_NAME,
                  TRANSPORTER_VENDOR_ID,
                  INITIAL_GATE_IN,
                  INITIAL_GATE_IN_DATE,
                  EMPTY_TRUCK_WT,
                  EMPTY_TRUCK_WT_DATE,
                  DRIVER_NAME,
                  SCALE_IN_WT,
                  FULL_TRUCK_WT_DATE,
                  SCALE_OUT_WT,
                  HIRE_RATE_AP,
                  HIRE_RATE_AR,
                  CONFIRM_FLAG,
                  CONFIRM_DATE,
                  TRANSFER_LOADING_FLAG,
                  ML.TRANSFER_LOADING_DATE,
                  TRUCK_LOADING_FLAG,
                  TRUCK_LOADING_DATE,
                  VAT_RECEIVED_FLAG,
                  VAT_RECEIVED_DATE,
                  CHALLANED_FLAG,
                  CHALLANED_DATE,
                  ML.VAT_CHALLAN_NO,
                  ML.VAT_CHALLAN_DATE,
                  VAT_IN_FLAG,
                  VAT_IN_DATE,
                  MOV_ORDER_TYPE,
                  METER_READING_START,
                  METER_READING_END,
                  OIL_REFILL_QTY_CNG,
                  OIL_REFILL_QTY_OCTANE,
                  KM_PER_LITRE,
                  ML.AR_FLAG,
                  MH.DRIVER_MOBILE,
                  MH.CONFIRMED_DATE
             FROM XXAKG_MOV_ORD_HDR MH, XXAKG_MOV_ORD_DTL ML
            WHERE MH.MOV_ORD_HDR_ID = ML.MOV_ORD_HDR_ID AND MH.ORG_ID = 85
            AND MH.WAREHOUSE_ORG_ID='101') m
    WHERE d.DO_HDR_ID = m.DO_HDR_ID(+);